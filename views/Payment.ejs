<%- include('includes/header.ejs') %>
<main>
    <div class="payment-container">
        <h1>Book Train</h1>
        <p class="subtitle">Fill in all the details to reserve your seat</p>
        <div class="center-container">
            <form class="payment-form" id="bookingForm" method="POST" action="/process-payment">
                <!-- User Details Section -->
                <div class="form-section">
                    <h2>User Details</h2>
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" placeholder="Enter your first name" value="<%= user.First_Name %>" disabled>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" placeholder="Enter your last name" value="<%= user.Last_Name %>" disabled>
                    </div>
                    <div class="form-group">
                        <label for="document">Identification document</label>
                        <input type="text" id="document" placeholder="Enter your Identification document" value="<%= user.IdentificationDoc %>" disabled>
                    </div>
                </div>
    
                <!-- Dependent Details Section -->
                <label>
                    <input type="checkbox" name="bookForDependents" id="bookForDependentsCheckbox">
                    Are you booking for dependents?
                </label>
            
                <!-- Dependents Section -->
                <div id="dependentsSection" style="display: none; margin-top: 1rem;">
                    <h3>Dependent Details</h3>
                    <ul id="dependentsList">
                        <% if (dependents && dependents.length > 0) { %>
                            <% dependents.forEach((dependent) => { %>
                                <li>
                                    <label>
                                        <input type="checkbox" class="dependent-checkbox" name="dependentList[]" data-name="<%= dependent.Name %>" value="<%= dependent.PersonID %>">
                                        <%= dependent.Name %> (<%= dependent.Relationship %>)
                      
                                    </label>
                                </li>
                            <% }); %>
                        <% } else { %>
                            <li>No dependents found.</li>
                        <% } %>
                    </ul>
                </div>
                <input type="hidden" name="trainCapacity" id="trainCapacity" value="<%= trip.capacity %>">
                <input type="hidden" name="availableSeats" id="availableSeats" value="<%= trip.availableSeats %>">
                <input type="hidden" name="tripId" value="<%= trip.TripID %>">
                <input type="hidden" id= "ticketPrice" name="ticketPrice" value="<%= trip.price %>">
                <input type="hidden" id= "selectedClass" name="selectedClass" value="<%= trip.selectedClass %>">
                <input type="hidden" id = "loyaltyDiscount"  name="loyaltyDiscount" value="<%= user.LoyaltyDiscount || 0 %>">
                <!-- Train Details Section -->
                <div class="form-section">
                    <h2>Train Details</h2>
                    <div class="form-group">
                        <label for="trainNumber">Trip ID</label>
                        <input type="text" name="tripId" id="trainNumber" placeholder="Enter train number" value="<%= trip.TripID %>" readonly>
                    </div>
                    <div class="form-group" id="seatInputsContainer">
                        <label for="seatNumber">Seat Numbers</label>
                        <div id="seatNumbers">
                            <!-- Seat inputs will be dynamically added here -->
                        </div>
                    </div>
                </div>
    
                <!-- Payment Section -->
                <div class="form-section">
                    <h2>Payment Details</h2>
                    <div class="form-group">
                        <label for="amount">Payment Amount</label>
                        <input type="text" name="amount" id="amount" readonly>
                    </div>
                    <div class="form-group">
                        <input type="hidden" name="calculatedAmount" id="calculatedAmount">
                    </div>
                    <div class="form-group">
                        <label for="code">Payment code</label>
                        <input type="text" id="code" name="code">
                    </div>
                    <!-- i want to add smth like check to say pay later -->
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="submit-btn">Pay Now</button>
            </form>
        </div>
    </div>    
</main>

<%- include('includes/footer.ejs') %>
<script src="payment.js"></script>
<script src="/header.js"></script>
</body>
</html>
